@model Chat
<div class="chat">
    <div class="chat__messages">
        <ul class="chat__messages-list">
            @foreach(var message in Model.Messages) {
                <li class="chat__messages-item">
                    <p class="chat__user-name">
                        <strong class="sr-only">@message.Name</strong>
                        <span class="chat__user-icon">@message.Name.Substring(0, 2)</span>
                    </p>
                    <p class="chat__user-message">@message.Text</p>
                    <time class="chat__user-message-time">@message.TimeStamp</time>
                </li>
            }
             
        </ul>
    </div>
    <form class="chat__form form-chat" asp-controller="Home" asp-action="CreateMessage">
        <label class="form-chat__label">
            <input type="hidden" value="@Model.Id" name="chatId">
            <input type="text"  name="msg" class="form-chat__input" />
        </label>
        <button class="form-chat__submit-btn btn btn--form">Send</button>
    </form>
</div>

@section scripts {
    <script src="~/js/signalr.min.js"></script>
    <script src="~/js/axios.min.js"></script>
    @* <script src="~/js/chat.js"></script> *@
    <script>
        let connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();

  let _connectionId = '';

  connection.on("ReceiveMessage", function (data){
      console.log(data);
  });

  connection.start().then(function(){
      connection.invoke('getConnectionId').then(function(connectionId){
          _connectionId = connectionId
          // debugger;
          joinRoom();
      })
  })
  .catch(function(err){
      console.log(err);
  });

  let joinRoom = function() {
      const URL = '/' + _connectionId + '/@Model.Name'
      axios.post(URL, null).then(res => {
          console.log("Joined in room", res);
      })
      .catch(err => {
          console.error("Failed to join in room", err);
      })
  }
    </script>
}
</div>
